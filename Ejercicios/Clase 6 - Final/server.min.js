!function(n,t,r,e){function c(){var t=n.getItem("contacts");return JSON.parse(t||"{}")}function a(t){n.setItem("contacts",JSON.stringify(t))}function u(n){var t=n.replace("/contacts","");return t.indexOf("/")!=-1?t.replace("/",""):null}function o(n){return s().then(function(){if(!n||!n.id||!c()[n.id])throw"Contact could not be found";var t=c();return t[n.id]=n,a(t),n})}function i(t){return s().then(function(){if(t){var r=c();delete r[t],a(r)}else n.clear(),a({});return!0})}function f(n){return s().then(function(){if(n)return c()[n];var t=Object.getOwnPropertyNames(c()),r=[];return t.forEach(function(n){r.push(c()[n])}),r})}function s(n){var t=new e(function(t,e){r(function(){var r=n||Math.random()<=.1;r?e("Internal Server Error"):t()},10*Math.random())});return t}function d(){return s(!0)}t.ajax=function(n,t){if(0!=n.indexOf("/contacts"))return d();switch(t.method){case"POST":return l(t.data.contact);case"PUT":return o(t.data.contact);case"DELETE":return i(u(n));case"GET":default:return f(u(n))}};var l=function(){var n=Object.getOwnPropertyNames(c()),t=0;return n.forEach(function(n){t=Number.parseInt(n)>t?Number.parseInt(n):t}),function(n){return s().then(function(){if(n){n.contactId=++t;var r=c();return r[t]=n,a(r),n}throw"Contact cannot be null"})}}()}(localStorage,$,setTimeout,Promise);